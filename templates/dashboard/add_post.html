{% extends 'dashboard/dashboard.html' %}
{% block meta_robots %}noindex, nofollow{% endblock %}
{% load crispy_forms_tags %}
{% load static %}


{% block dashboard_content %}

<div class="dashboard-container">
    
    <!-- Main Content -->
    <main class="dashboard-main">
        <h2 class="dashboard-title">Add New Post</h2>

        <!-- Display success/error messages -->
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }}">
                    <strong>
                        {% if message.tags == 'success' %}‚úì{% elif message.tags == 'warning' %}‚ö†{% elif message.tags == 'error' %}‚úó{% endif %}
                    </strong>
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}

        <!-- Newsletter Preview Section -->
        {% if post %}
            <div class="post-preview">
                <h3>üìß Newsletter Preview</h3>
                <p>This is how your post will appear in subscriber emails:</p>
                
                <div class="newsletter-preview">
                    <h4>{{ post.title }}</h4>
                    <p class="post-meta">
                        By: {{ post.author.get_full_name|default:post.author.username }}
                    </p>
                    <p>{{ post.body|truncatewords:30|striptags }}...</p>
                    <a href="/post/{{ post.slug }}/" class="read-more-btn">Read Full Post</a>
                </div>
                
                <hr>
                <small class="newsletter-info">
                    üì¨ This will be sent to all newsletter subscribers automatically when published.
                    <br>
                    If you no longer wish to receive updates,
                    <a href="/unsubscribe/">unsubscribe here</a>.
                </small>
            </div>
        {% endif %}

        <div class="dashboard-form-wrapper">
            <form action="{% url 'add_post' %}" method="POST" enctype="multipart/form-data" class="dashboard-form">
                {% csrf_token %}
                {{ form.media }}
                {{ form|crispy }}
                
                <div style="margin-top: 20px;">
                    <button type="submit" class="btn-primary publish-button">
                        üìù Publish Post & Send Newsletter
                    </button>
                    <p class="publish-note">
                        * Your post will be published and automatically sent to all newsletter subscribers
                    </p>
                </div>
            </form>
        </div>
    </main>
</div>
{% endblock %}